<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trading Journal Dashboard</title>

  <style>
    /* ===================================
       CSS VARIABLES (Dark Mode Theme)
       =================================== */
    :root {
      /* Colors */
      --color-background: #121212;
      --color-surface: #1e1e1e;
      --color-surface-elevated: #2d2d2d;
      --color-text-primary: #ffffff;
      --color-text-secondary: #b0b0b0;
      --color-text-tertiary: #808080;
      --color-success: #00c853;
      --color-danger: #ff5252;
      --color-info: #2196f3;
      --color-warning: #ffa726;
      --color-border: #333333;

      /* Spacing */
      --spacing-xs: 0.25rem;
      --spacing-sm: 0.5rem;
      --spacing-md: 1rem;
      --spacing-lg: 1.5rem;
      --spacing-xl: 2rem;
      --spacing-xxl: 3rem;

      /* Typography */
      --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      --font-size-sm: 0.875rem;
      --font-size-base: 1rem;
      --font-size-lg: 1.125rem;
      --font-size-xl: 1.5rem;
      --font-size-xxl: 2rem;

      /* Border radius */
      --border-radius-sm: 4px;
      --border-radius-md: 8px;
      --border-radius-lg: 12px;

      /* Shadows */
      --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.5);

      /* Transitions */
      --transition-base: 0.2s ease;
    }

    /* ===================================
       RESET & BASE STYLES
       =================================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-family);
      font-size: var(--font-size-base);
      line-height: 1.6;
      color: var(--color-text-primary);
      background-color: var(--color-background);
      padding: var(--spacing-lg);
      min-height: 100vh;
    }

    /* ===================================
       LAYOUT - HEADER
       =================================== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-xl);
      flex-wrap: wrap;
      gap: var(--spacing-md);
    }

    .header__title {
      font-size: var(--font-size-xxl);
      font-weight: 700;
      color: var(--color-text-primary);
    }

    .header__actions {
      display: flex;
      gap: var(--spacing-sm);
      flex-wrap: wrap;
    }

    /* ===================================
       BUTTONS (BEM)
       =================================== */
    .btn {
      padding: var(--spacing-sm) var(--spacing-md);
      border: none;
      border-radius: var(--border-radius-sm);
      font-size: var(--font-size-sm);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-base);
      text-decoration: none;
      display: inline-block;
    }

    .btn--primary {
      background-color: var(--color-info);
      color: white;
    }

    .btn--primary:hover {
      background-color: #1976d2;
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .btn--secondary {
      background-color: var(--color-surface-elevated);
      color: var(--color-text-primary);
      border: 1px solid var(--color-border);
    }

    .btn--secondary:hover {
      background-color: #3d3d3d;
    }

    .btn--danger {
      background-color: var(--color-danger);
      color: white;
    }

    .btn--danger:hover {
      background-color: #d32f2f;
    }

    .btn--small {
      padding: var(--spacing-xs) var(--spacing-sm);
      font-size: 0.75rem;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* ===================================
       METRICS DASHBOARD (BEM)
       =================================== */
    .metrics {
      margin-bottom: var(--spacing-xl);
    }

    .metrics__section-title {
      font-size: var(--font-size-lg);
      font-weight: 600;
      margin-bottom: var(--spacing-md);
      color: var(--color-text-secondary);
    }

    .metrics__grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-xl);
    }

    .metric-card {
      background-color: var(--color-surface);
      border-radius: var(--border-radius-md);
      padding: var(--spacing-lg);
      box-shadow: var(--shadow-sm);
      transition: transform var(--transition-base);
    }

    .metric-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .metric-card--primary {
      background: linear-gradient(135deg, var(--color-surface-elevated), var(--color-surface));
    }

    .metric-card__label {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      margin-bottom: var(--spacing-sm);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .metric-card__value {
      font-size: var(--font-size-xl);
      font-weight: 700;
      color: var(--color-text-primary);
    }

    .metric-card__value--success {
      color: var(--color-success);
    }

    .metric-card__value--danger {
      color: var(--color-danger);
    }

    .metric-card__value--info {
      color: var(--color-info);
    }

    /* ===================================
       FORM SECTION (BEM)
       =================================== */
    .form-section {
      background-color: var(--color-surface);
      border-radius: var(--border-radius-md);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
      box-shadow: var(--shadow-sm);
    }

    .form-section__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
      cursor: pointer;
      user-select: none;
    }

    .form-section__title {
      font-size: var(--font-size-lg);
      font-weight: 600;
    }

    .form-section__toggle {
      font-size: var(--font-size-lg);
      color: var(--color-text-secondary);
    }

    .form-section__content {
      overflow: hidden;
      transition: max-height var(--transition-base);
    }

    .form-section__content--collapsed {
      max-height: 0;
    }

    .trade-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-md);
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group--full {
      grid-column: 1 / -1;
    }

    .form-group__label {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      margin-bottom: var(--spacing-xs);
      font-weight: 500;
    }

    .form-group__label--required::after {
      content: ' *';
      color: var(--color-danger);
    }

    .form-control {
      padding: var(--spacing-sm);
      border: 1px solid var(--color-border);
      border-radius: var(--border-radius-sm);
      background-color: var(--color-background);
      color: var(--color-text-primary);
      font-size: var(--font-size-base);
      transition: border-color var(--transition-base);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--color-info);
    }

    .form-control::placeholder {
      color: var(--color-text-tertiary);
    }

    textarea.form-control {
      min-height: 80px;
      resize: vertical;
      font-family: var(--font-family);
    }

    select.form-control {
      cursor: pointer;
    }

    .form-actions {
      grid-column: 1 / -1;
      display: flex;
      gap: var(--spacing-sm);
      margin-top: var(--spacing-md);
    }

    /* ===================================
       TABLE SECTION (BEM)
       =================================== */
    .table-section {
      background-color: var(--color-surface);
      border-radius: var(--border-radius-md);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
      box-shadow: var(--shadow-sm);
    }

    .table-section__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
      flex-wrap: wrap;
      gap: var(--spacing-md);
    }

    .table-section__title {
      font-size: var(--font-size-lg);
      font-weight: 600;
    }

    .table-section__filters {
      display: flex;
      gap: var(--spacing-sm);
      flex-wrap: wrap;
    }

    .table-wrapper {
      overflow-x: auto;
      margin-bottom: var(--spacing-md);
    }

    .trades-table {
      width: 100%;
      border-collapse: collapse;
      font-size: var(--font-size-sm);
    }

    .trades-table__header {
      background-color: var(--color-surface-elevated);
    }

    .trades-table__header-cell {
      padding: var(--spacing-sm) var(--spacing-md);
      text-align: left;
      font-weight: 600;
      color: var(--color-text-secondary);
      border-bottom: 2px solid var(--color-border);
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
    }

    .trades-table__header-cell:hover {
      background-color: #3d3d3d;
    }

    .trades-table__row {
      border-bottom: 1px solid var(--color-border);
      transition: background-color var(--transition-base);
    }

    .trades-table__row:hover {
      background-color: var(--color-surface-elevated);
    }

    .trades-table__row--win {
      border-left: 3px solid var(--color-success);
    }

    .trades-table__row--loss {
      border-left: 3px solid var(--color-danger);
    }

    .trades-table__row--open {
      border-left: 3px solid var(--color-info);
    }

    .trades-table__cell {
      padding: var(--spacing-sm) var(--spacing-md);
      color: var(--color-text-primary);
    }

    .trades-table__cell--success {
      color: var(--color-success);
      font-weight: 600;
    }

    .trades-table__cell--danger {
      color: var(--color-danger);
      font-weight: 600;
    }

    .trades-table__cell--info {
      color: var(--color-info);
      font-weight: 600;
    }

    .trades-table__actions {
      display: flex;
      gap: var(--spacing-xs);
    }

    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: var(--spacing-sm);
      margin-top: var(--spacing-md);
    }

    .pagination__info {
      color: var(--color-text-secondary);
      font-size: var(--font-size-sm);
    }

    /* ===================================
       NOTIFICATION (BEM)
       =================================== */
    .notification {
      position: fixed;
      top: var(--spacing-md);
      right: var(--spacing-md);
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: var(--border-radius-md);
      box-shadow: var(--shadow-lg);
      color: white;
      font-weight: 500;
      z-index: 1000;
      animation: slideIn 0.3s ease;
      max-width: 400px;
    }

    .notification--success {
      background-color: var(--color-success);
    }

    .notification--error {
      background-color: var(--color-danger);
    }

    .notification--info {
      background-color: var(--color-info);
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* ===================================
       SYNC STATUS (BEM)
       =================================== */
    .sync-status {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      padding: var(--spacing-xs) var(--spacing-sm);
      background-color: var(--color-surface);
      border-radius: var(--border-radius-sm);
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
    }

    .sync-status__icon {
      font-size: var(--font-size-lg);
      animation: none;
    }

    .sync-status--syncing .sync-status__icon {
      animation: rotate 1s linear infinite;
      color: var(--color-info);
    }

    .sync-status--synced {
      color: var(--color-success);
    }

    .sync-status--error {
      color: var(--color-danger);
    }

    @keyframes rotate {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }

    /* ===================================
       MODAL (BEM)
       =================================== */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      padding: var(--spacing-md);
    }

    .modal__content {
      background-color: var(--color-surface);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-lg);
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-lg);
      border-bottom: 1px solid var(--color-border);
    }

    .modal__header h2 {
      font-size: var(--font-size-xl);
      color: var(--color-text-primary);
    }

    .modal__close {
      background: none;
      border: none;
      font-size: 2rem;
      color: var(--color-text-secondary);
      cursor: pointer;
      padding: 0;
      width: 2rem;
      height: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color var(--transition-base);
    }

    .modal__close:hover {
      color: var(--color-text-primary);
    }

    .modal__body {
      padding: var(--spacing-lg);
    }

    .modal__footer {
      display: flex;
      justify-content: flex-end;
      gap: var(--spacing-sm);
      padding: var(--spacing-lg);
      border-top: 1px solid var(--color-border);
    }

    /* ===================================
       EMPTY STATE (BEM)
       =================================== */
    .empty-state {
      text-align: center;
      padding: var(--spacing-xxl);
      color: var(--color-text-secondary);
    }

    .empty-state__icon {
      font-size: 4rem;
      margin-bottom: var(--spacing-md);
      opacity: 0.5;
    }

    .empty-state__message {
      font-size: var(--font-size-lg);
      margin-bottom: var(--spacing-sm);
    }

    .empty-state__hint {
      font-size: var(--font-size-sm);
      color: var(--color-text-tertiary);
    }

    /* ===================================
       UTILITY CLASSES
       =================================== */
    .hidden {
      display: none !important;
    }

    .text-center {
      text-align: center;
    }

    .mb-0 { margin-bottom: 0 !important; }
    .mb-1 { margin-bottom: var(--spacing-sm) !important; }
    .mb-2 { margin-bottom: var(--spacing-md) !important; }
    .mb-3 { margin-bottom: var(--spacing-lg) !important; }

    /* ===================================
       RESPONSIVE DESIGN
       =================================== */
    @media (max-width: 768px) {
      body {
        padding: var(--spacing-md);
      }

      .header {
        flex-direction: column;
        align-items: flex-start;
      }

      .header__title {
        font-size: var(--font-size-xl);
      }

      .metrics__grid {
        grid-template-columns: 1fr;
      }

      .trade-form {
        grid-template-columns: 1fr;
      }

      .table-wrapper {
        border-radius: var(--border-radius-sm);
      }

      .trades-table {
        font-size: 0.75rem;
      }

      .trades-table__header-cell,
      .trades-table__cell {
        padding: var(--spacing-xs) var(--spacing-sm);
      }

      .notification {
        left: var(--spacing-md);
        right: var(--spacing-md);
        max-width: none;
      }
    }

    @media (max-width: 480px) {
      .header__actions {
        width: 100%;
      }

      .btn {
        flex: 1;
        text-align: center;
      }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="header">
    <div style="display: flex; align-items: center; gap: var(--spacing-md);">
      <h1 class="header__title">üìä Trading Journal</h1>
      <div id="syncStatus" class="sync-status" style="display: none;">
        <span class="sync-status__icon">‚ü≥</span>
        <span class="sync-status__text">Synced</span>
      </div>
    </div>
    <div class="header__actions">
      <button class="btn btn--info btn--small" id="githubSetupBtn" style="display: none;">‚öôÔ∏è Setup GitHub Sync</button>
      <button class="btn btn--secondary btn--small" id="manualSyncBtn" style="display: none;">üîÑ Sync Now</button>
      <button class="btn btn--secondary" id="exportCsvBtn">Export CSV</button>
      <button class="btn btn--secondary" id="exportJsonBtn">Export JSON</button>
      <button class="btn btn--secondary" id="importJsonBtn">Import Trades</button>
      <button class="btn btn--primary" id="importStrategiesBtn">Import Strategies</button>
      <button class="btn btn--danger btn--small" id="clearDataBtn">Clear Data</button>
    </div>
  </header>

  <!-- METRICS DASHBOARD -->
  <section class="metrics">
    <h2 class="metrics__section-title">Performance Metrics (Closed Trades)</h2>
    <div class="metrics__grid" id="metricsGrid">
      <!-- Metrics cards will be rendered here -->
    </div>

    <h2 class="metrics__section-title">Open Positions</h2>
    <div class="metrics__grid" id="openTradesGrid">
      <!-- Open trades summary will be rendered here -->
    </div>
  </section>

  <!-- TRADE ENTRY FORM -->
  <section class="form-section">
    <div class="form-section__header" id="formToggle">
      <h2 class="form-section__title">Add New Trade</h2>
      <span class="form-section__toggle">‚àí</span>
    </div>
    <div class="form-section__content" id="formContent">
      <form class="trade-form" id="tradeForm">
        <div class="form-group">
          <label class="form-group__label form-group__label--required" for="tradeDate">Date</label>
          <input type="date" class="form-control" id="tradeDate" required>
        </div>

        <div class="form-group">
          <label class="form-group__label form-group__label--required" for="tradeSymbol">Symbol</label>
          <input type="text" class="form-control" id="tradeSymbol" placeholder="BTCUSD, AAPL, etc." required>
        </div>

        <div class="form-group">
          <label class="form-group__label form-group__label--required" for="tradeDirection">Direction</label>
          <select class="form-control" id="tradeDirection" required>
            <option value="">Select...</option>
            <option value="long">Long</option>
            <option value="short">Short</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-group__label form-group__label--required" for="tradeEntry">Entry Price (‚Ç¨)</label>
          <input type="number" step="0.01" class="form-control" id="tradeEntry" placeholder="0.00" required>
        </div>

        <div class="form-group">
          <label class="form-group__label" for="tradeExit" id="exitLabel">Exit Price (‚Ç¨)</label>
          <input type="number" step="0.01" class="form-control" id="tradeExit" placeholder="0.00">
        </div>

        <div class="form-group">
          <label class="form-group__label form-group__label--required" for="tradeStopLoss">Stop Loss (‚Ç¨)</label>
          <input type="number" step="0.01" class="form-control" id="tradeStopLoss" placeholder="0.00" required>
        </div>

        <div class="form-group">
          <label class="form-group__label form-group__label--required" for="tradeSize">Position Size</label>
          <input type="number" step="0.01" class="form-control" id="tradeSize" placeholder="0.00" required>
        </div>

        <div class="form-group">
          <label class="form-group__label form-group__label--required" for="tradeStatus">Status</label>
          <select class="form-control" id="tradeStatus" required>
            <option value="">Select...</option>
            <option value="open">Open</option>
            <option value="closed">Closed</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-group__label form-group__label--required" for="tradeStrategy">Strategy</label>
          <select class="form-control" id="tradeStrategy" required>
            <!-- Strategies will be populated dynamically -->
          </select>
        </div>

        <div class="form-group form-group--full">
          <label class="form-group__label" for="tradeNotes">Notes</label>
          <textarea class="form-control" id="tradeNotes" placeholder="Trade analysis, observations, etc."></textarea>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn--primary" id="submitBtn">Add Trade</button>
          <button type="button" class="btn btn--secondary" id="cancelBtn">Cancel</button>
        </div>
      </form>
    </div>
  </section>

  <!-- TRADE HISTORY TABLE -->
  <section class="table-section">
    <div class="table-section__header">
      <h2 class="table-section__title">Trade History</h2>
      <div class="table-section__filters">
        <input type="text" class="form-control" id="searchInput" placeholder="Search symbol...">
        <select class="form-control" id="statusFilter">
          <option value="all">All Trades</option>
          <option value="open">Open Only</option>
          <option value="closed">Closed Only</option>
        </select>
        <select class="form-control" id="strategyFilter">
          <option value="all">All Strategies</option>
          <!-- Will be populated dynamically -->
        </select>
      </div>
    </div>

    <div class="table-wrapper">
      <table class="trades-table">
        <thead class="trades-table__header">
          <tr>
            <th class="trades-table__header-cell" data-sort="status">Status</th>
            <th class="trades-table__header-cell" data-sort="date">Date</th>
            <th class="trades-table__header-cell" data-sort="symbol">Symbol</th>
            <th class="trades-table__header-cell" data-sort="direction">Direction</th>
            <th class="trades-table__header-cell" data-sort="entryPrice">Entry</th>
            <th class="trades-table__header-cell" data-sort="exitPrice">Exit</th>
            <th class="trades-table__header-cell" data-sort="stopLoss">Stop</th>
            <th class="trades-table__header-cell" data-sort="pnl">P&L</th>
            <th class="trades-table__header-cell" data-sort="riskReward">R:R</th>
            <th class="trades-table__header-cell" data-sort="strategy">Strategy</th>
            <th class="trades-table__header-cell">Actions</th>
          </tr>
        </thead>
        <tbody id="tradesTableBody">
          <!-- Trades will be rendered here -->
        </tbody>
      </table>
    </div>

    <div class="pagination" id="pagination">
      <!-- Pagination will be rendered here -->
    </div>
  </section>

  <!-- Hidden file inputs -->
  <input type="file" id="jsonFileInput" accept=".json" style="display: none;">
  <input type="file" id="strategyFileInput" accept=".json" multiple style="display: none;">

  <!-- GitHub Setup Modal -->
  <div id="githubSetupModal" class="modal" style="display: none;">
    <div class="modal__content">
      <div class="modal__header">
        <h2>üîó GitHub Sync Setup</h2>
        <button class="modal__close" id="closeGithubModal">&times;</button>
      </div>
      <div class="modal__body">
        <p style="margin-bottom: var(--spacing-md); color: var(--color-text-secondary);">
          Enable manual sync across all your devices using GitHub Gist. Use the same token on all devices to sync to the same Gist.
        </p>

        <div class="form-group">
          <label class="form-group__label">Step 1: Create GitHub Personal Access Token</label>
          <ol style="color: var(--color-text-secondary); font-size: var(--font-size-sm); line-height: 1.8; margin: var(--spacing-sm) 0 var(--spacing-md) var(--spacing-md);">
            <li>Go to <a href="https://github.com/settings/tokens/new" target="_blank" style="color: var(--color-info);">GitHub Token Settings</a></li>
            <li>Set <strong>Note</strong>: "Trading Journal Sync"</li>
            <li>Set <strong>Expiration</strong>: No expiration (or your preference)</li>
            <li>Select scope: <strong>‚úì gist</strong> (only this permission needed)</li>
            <li>Click <strong>"Generate token"</strong></li>
            <li>Copy the token (you won't be able to see it again!)</li>
          </ol>
        </div>

        <div class="form-group">
          <label class="form-group__label" for="githubTokenInput">Step 2: Paste Your Token Here</label>
          <input
            type="password"
            id="githubTokenInput"
            class="form-group__input"
            placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
          />
          <small style="color: var(--color-text-tertiary); font-size: var(--font-size-sm);">
            Your token is stored securely in your browser and never shared.
          </small>
        </div>

        <div id="githubSetupError" class="form-group" style="display: none;">
          <p style="color: var(--color-danger); font-size: var(--font-size-sm);"></p>
        </div>

        <div id="githubSetupSuccess" class="form-group" style="display: none;">
          <p style="color: var(--color-success); font-size: var(--font-size-sm);">
            ‚úì GitHub sync configured successfully! Click "üîÑ Sync Now" to sync your trades across devices.
          </p>
        </div>
      </div>
      <div class="modal__footer">
        <button class="btn btn--secondary" id="cancelGithubSetup">Cancel</button>
        <button class="btn btn--primary" id="saveGithubToken">Save & Enable Sync</button>
      </div>
    </div>
  </div>

  <script>
    /* ===================================
       CONFIGURATION
       =================================== */
    const CONFIG = {
      STORAGE_KEY: 'tradingJournal_trades',
      STRATEGIES_KEY: 'tradingJournal_strategies',
      SETTINGS_KEY: 'tradingJournal_settings',
      GITHUB_TOKEN_KEY: 'tradingJournal_githubToken',
      GITHUB_GIST_KEY: 'tradingJournal_gistId',
      VERSION: '1.0.0',
      TRADES_PER_PAGE: 20,
      DEFAULT_CURRENCY: 'EUR',
      DATE_FORMAT: 'DD/MM/YYYY',
      DEFAULT_STRATEGIES: ['Custom'],
      GITHUB: {
        GIST_FILENAME: 'trading-journal-data.json',
        GIST_DESCRIPTION: 'Trading Journal Data - Manual sync',
        // AUTO_SYNC_INTERVAL: 30000, // Disabled to avoid API rate limits
        API_BASE_URL: 'https://api.github.com'
      }
    };

    /* ===================================
       STATE
       =================================== */
    let currentPage = 1;
    let editingTradeId = null;
    let sortColumn = 'date';
    let sortDirection = 'desc';
    let syncInProgress = false;
    let autoSyncInterval = null;

    /* ===================================
       GITHUB SYNC SERVICE
       =================================== */
    const GitHubSync = {
      /**
       * Check if GitHub sync is enabled
       */
      isEnabled() {
        const token = localStorage.getItem(CONFIG.GITHUB_TOKEN_KEY);
        return token !== null && token !== '';
      },

      /**
       * Get stored GitHub token
       */
      getToken() {
        return localStorage.getItem(CONFIG.GITHUB_TOKEN_KEY);
      },

      /**
       * Get stored Gist ID
       */
      getGistId() {
        return localStorage.getItem(CONFIG.GITHUB_GIST_KEY);
      },

      /**
       * Save GitHub token
       */
      saveToken(token) {
        localStorage.setItem(CONFIG.GITHUB_TOKEN_KEY, token);
      },

      /**
       * Save Gist ID
       */
      saveGistId(gistId) {
        localStorage.setItem(CONFIG.GITHUB_GIST_KEY, gistId);
      },

      /**
       * Remove GitHub credentials
       */
      clearCredentials() {
        localStorage.removeItem(CONFIG.GITHUB_TOKEN_KEY);
        localStorage.removeItem(CONFIG.GITHUB_GIST_KEY);
      },

      /**
       * Find existing Gist by searching user's gists
       */
      async findExistingGist() {
        const token = this.getToken();
        if (!token) throw new Error('No GitHub token configured');

        const response = await fetch(`${CONFIG.GITHUB.API_BASE_URL}/gists`, {
          headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });

        if (!response.ok) {
          throw new Error('Failed to fetch gists');
        }

        const gists = await response.json();

        // Find gist by description or filename
        const tradingJournalGist = gists.find(gist =>
          gist.description === CONFIG.GITHUB.GIST_DESCRIPTION ||
          gist.files[CONFIG.GITHUB.GIST_FILENAME]
        );

        if (tradingJournalGist) {
          console.log('Found existing Gist:', tradingJournalGist.id);
          this.saveGistId(tradingJournalGist.id);
          return tradingJournalGist.id;
        }

        return null;
      },

      /**
       * Update sync status UI
       */
      updateSyncStatus(status, message) {
        const syncStatus = document.getElementById('syncStatus');
        const syncText = syncStatus.querySelector('.sync-status__text');

        syncStatus.classList.remove('sync-status--syncing', 'sync-status--synced', 'sync-status--error');

        if (status === 'syncing') {
          syncStatus.classList.add('sync-status--syncing');
          syncText.textContent = message || 'Syncing...';
        } else if (status === 'synced') {
          syncStatus.classList.add('sync-status--synced');
          syncText.textContent = message || 'Synced';
        } else if (status === 'error') {
          syncStatus.classList.add('sync-status--error');
          syncText.textContent = message || 'Sync Error';
        }
      },

      /**
       * Create a new private Gist
       */
      async createGist(data) {
        const token = this.getToken();
        if (!token) throw new Error('No GitHub token configured');

        const response = await fetch(`${CONFIG.GITHUB.API_BASE_URL}/gists`, {
          method: 'POST',
          headers: {
            'Authorization': `token ${token}`,
            'Content-Type': 'application/json',
            'Accept': 'application/vnd.github.v3+json'
          },
          body: JSON.stringify({
            description: CONFIG.GITHUB.GIST_DESCRIPTION,
            public: false,
            files: {
              [CONFIG.GITHUB.GIST_FILENAME]: {
                content: JSON.stringify(data, null, 2)
              }
            }
          })
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.message || 'Failed to create Gist');
        }

        const gist = await response.json();
        this.saveGistId(gist.id);
        return gist;
      },

      /**
       * Update existing Gist
       */
      async updateGist(data) {
        const token = this.getToken();
        const gistId = this.getGistId();

        if (!token) throw new Error('No GitHub token configured');
        if (!gistId) throw new Error('No Gist ID found');

        const response = await fetch(`${CONFIG.GITHUB.API_BASE_URL}/gists/${gistId}`, {
          method: 'PATCH',
          headers: {
            'Authorization': `token ${token}`,
            'Content-Type': 'application/json',
            'Accept': 'application/vnd.github.v3+json'
          },
          body: JSON.stringify({
            files: {
              [CONFIG.GITHUB.GIST_FILENAME]: {
                content: JSON.stringify(data, null, 2)
              }
            }
          })
        });

        if (!response.ok) {
          // If Gist was deleted (404), clear the stale ID
          if (response.status === 404) {
            console.log('Gist no longer exists, clearing stale ID');
            localStorage.removeItem(CONFIG.GITHUB_GIST_KEY);
            throw new Error('Gist was deleted. Click "Sync Now" again to create a new one.');
          }
          const error = await response.json();
          throw new Error(error.message || 'Failed to update Gist');
        }

        return await response.json();
      },

      /**
       * Get data from Gist
       */
      async getGistData() {
        const token = this.getToken();
        const gistId = this.getGistId();

        if (!token) throw new Error('No GitHub token configured');
        if (!gistId) return null;

        const response = await fetch(`${CONFIG.GITHUB.API_BASE_URL}/gists/${gistId}`, {
          headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });

        if (!response.ok) {
          if (response.status === 404) {
            // Gist doesn't exist anymore, clear the ID
            localStorage.removeItem(CONFIG.GITHUB_GIST_KEY);
            return null;
          }
          const error = await response.json();
          throw new Error(error.message || 'Failed to fetch Gist');
        }

        const gist = await response.json();
        const file = gist.files[CONFIG.GITHUB.GIST_FILENAME];

        if (!file) return null;

        return JSON.parse(file.content);
      },

      /**
       * Sync trades to GitHub Gist
       */
      async syncToGist(trades, strategies) {
        if (syncInProgress) {
          console.log('Sync already in progress, skipping...');
          return;
        }

        if (!this.isEnabled()) {
          console.log('GitHub sync not enabled, skipping...');
          return;
        }

        syncInProgress = true;
        this.updateSyncStatus('syncing', 'Syncing...');

        try {
          const data = {
            version: CONFIG.VERSION,
            lastSync: new Date().toISOString(),
            trades: trades || [],
            strategies: strategies || CONFIG.DEFAULT_STRATEGIES
          };

          let gistId = this.getGistId();

          // If no Gist ID stored, try to find existing Gist first
          if (!gistId) {
            console.log('No Gist ID found locally, searching for existing Gist...');
            gistId = await this.findExistingGist();
          }

          if (gistId) {
            // Update existing Gist
            await this.updateGist(data);
          } else {
            // Create new Gist
            await this.createGist(data);
          }

          this.updateSyncStatus('synced', 'Synced ‚úì');
          console.log('Successfully synced to GitHub Gist');

          // Reset to "Synced" after 3 seconds
          setTimeout(() => {
            this.updateSyncStatus('synced', 'Synced');
          }, 3000);

        } catch (error) {
          console.error('Failed to sync to GitHub:', error);
          this.updateSyncStatus('error', 'Sync Failed');
          UI.showNotification(`Sync failed: ${error.message}`, 'error');
        } finally {
          syncInProgress = false;
        }
      },

      /**
       * Load trades from GitHub Gist
       */
      async loadFromGist() {
        if (!this.isEnabled()) {
          return null;
        }

        this.updateSyncStatus('syncing', 'Loading...');

        try {
          // If no Gist ID is stored, try to find existing Gist
          if (!this.getGistId()) {
            console.log('No Gist ID found locally, searching for existing Gist...');
            await this.findExistingGist();
          }

          const data = await this.getGistData();

          if (data) {
            this.updateSyncStatus('synced', 'Loaded ‚úì');

            // Reset to "Synced" after 3 seconds
            setTimeout(() => {
              this.updateSyncStatus('synced', 'Synced');
            }, 3000);

            return data;
          } else {
            // No Gist exists yet, this is normal for first-time setup
            this.updateSyncStatus('synced', 'Ready');
            return null;
          }
        } catch (error) {
          console.error('Failed to load from GitHub:', error);
          this.updateSyncStatus('error', 'Load Failed');
          return null;
        }
      },

      /**
       * Verify GitHub token is valid
       */
      async verifyToken(token) {
        const response = await fetch(`${CONFIG.GITHUB.API_BASE_URL}/user`, {
          headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });

        if (!response.ok) {
          throw new Error('Invalid GitHub token');
        }

        const user = await response.json();
        return user;
      },

      /**
       * Start auto-sync interval
       */
      startAutoSync() {
        if (!this.isEnabled()) return;

        // Clear existing interval
        if (autoSyncInterval) {
          clearInterval(autoSyncInterval);
        }

        // Set up new interval
        autoSyncInterval = setInterval(async () => {
          const trades = DataService.getTrades();
          const strategies = DataService.getStrategies();
          await this.syncToGist(trades, strategies);
        }, CONFIG.GITHUB.AUTO_SYNC_INTERVAL);

        console.log('Auto-sync started');
      },

      /**
       * Stop auto-sync interval
       */
      stopAutoSync() {
        if (autoSyncInterval) {
          clearInterval(autoSyncInterval);
          autoSyncInterval = null;
          console.log('Auto-sync stopped');
        }
      }
    };

    /* ===================================
       UTILITY FUNCTIONS
       =================================== */

    // Generate UUID v4
    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        const r = Math.random() * 16 | 0;
        const v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    // Format date to DD/MM/YYYY
    function formatDate(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString);
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = date.getFullYear();
      return `${day}/${month}/${year}`;
    }

    // Format currency
    function formatCurrency(amount) {
      if (amount === null || amount === undefined) return '‚Äî';
      const formatted = Math.abs(amount).toFixed(2);
      const sign = amount >= 0 ? '+' : '-';
      return `${sign}‚Ç¨${formatted}`;
    }

    // Format percentage
    function formatPercentage(value) {
      if (value === null || value === undefined) return '‚Äî';
      return `${value.toFixed(2)}%`;
    }

    /* ===================================
       DATA SERVICE LAYER
       =================================== */
    const DataService = {
      // Get all trades
      getTrades() {
        try {
          const data = localStorage.getItem(CONFIG.STORAGE_KEY);
          return data ? JSON.parse(data) : [];
        } catch (error) {
          console.error('Error loading trades:', error);
          return [];
        }
      },

      // Save all trades
      saveTrades(trades) {
        try {
          localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(trades));

          // Auto-sync disabled to avoid API rate limits - use manual "Sync Now" button instead
          // if (GitHubSync.isEnabled()) {
          //   const strategies = this.getStrategies();
          //   GitHubSync.syncToGist(trades, strategies).catch(err => {
          //     console.error('Background sync failed:', err);
          //   });
          // }

          return true;
        } catch (error) {
          if (error.name === 'QuotaExceededError') {
            UI.showNotification('Storage quota exceeded! Please export and clear old data.', 'error');
          } else {
            console.error('Error saving trades:', error);
          }
          return false;
        }
      },

      // Add new trade
      addTrade(trade) {
        const trades = this.getTrades();
        trades.push(trade);
        return this.saveTrades(trades);
      },

      // Update trade
      updateTrade(id, updates) {
        const trades = this.getTrades();
        const index = trades.findIndex(t => t.id === id);
        if (index !== -1) {
          trades[index] = { ...trades[index], ...updates, updatedAt: Date.now() };
          return this.saveTrades(trades);
        }
        return false;
      },

      // Delete trade
      deleteTrade(id) {
        const trades = this.getTrades();
        const filtered = trades.filter(t => t.id !== id);
        return this.saveTrades(filtered);
      },

      // Get strategies
      getStrategies() {
        try {
          const data = localStorage.getItem(CONFIG.STRATEGIES_KEY);
          return data ? JSON.parse(data) : CONFIG.DEFAULT_STRATEGIES;
        } catch (error) {
          console.error('Error loading strategies:', error);
          return CONFIG.DEFAULT_STRATEGIES;
        }
      },

      // Save strategies
      saveStrategies(strategies) {
        try {
          localStorage.setItem(CONFIG.STRATEGIES_KEY, JSON.stringify(strategies));

          // Auto-sync disabled to avoid API rate limits - use manual "Sync Now" button instead
          // if (GitHubSync.isEnabled()) {
          //   const trades = this.getTrades();
          //   GitHubSync.syncToGist(trades, strategies).catch(err => {
          //     console.error('Background sync failed:', err);
          //   });
          // }

          return true;
        } catch (error) {
          console.error('Error saving strategies:', error);
          return false;
        }
      },

      // Clear all data
      clearAll() {
        localStorage.removeItem(CONFIG.STORAGE_KEY);
        localStorage.removeItem(CONFIG.STRATEGIES_KEY);
        localStorage.setItem(CONFIG.STRATEGIES_KEY, JSON.stringify(CONFIG.DEFAULT_STRATEGIES));
      }
    };

    /* ===================================
       CALCULATOR LAYER
       =================================== */
    const Calculator = {
      // Calculate risk amount
      calculateRisk(entryPrice, stopLoss, positionSize) {
        return Math.abs(entryPrice - stopLoss) * positionSize;
      },

      // Calculate P&L for closed trade
      calculatePnL(direction, entryPrice, exitPrice, positionSize) {
        if (direction === 'long') {
          return (exitPrice - entryPrice) * positionSize;
        } else { // short
          return (entryPrice - exitPrice) * positionSize;
        }
      },

      // Calculate reward amount
      calculateReward(entryPrice, exitPrice, positionSize) {
        return Math.abs(exitPrice - entryPrice) * positionSize;
      },

      // Calculate risk:reward ratio
      calculateRiskReward(risk, reward) {
        if (risk === 0) return null;
        const ratio = reward / risk;
        return {
          numeric: ratio,
          formatted: `1:${ratio.toFixed(2)}`
        };
      },

      // Calculate all metrics for closed trades
      calculateMetrics(trades) {
        const closedTrades = trades.filter(t => t.status === 'closed');
        const openTrades = trades.filter(t => t.status === 'open');

        if (closedTrades.length === 0) {
          return {
            closed: {
              totalTrades: 0,
              winningTrades: 0,
              losingTrades: 0,
              winRate: 0,
              totalPnL: 0,
              avgWin: 0,
              avgLoss: 0,
              avgRR: 0,
              profitFactor: 0,
              expectancy: 0,
              bestTrade: 0,
              worstTrade: 0
            },
            open: {
              count: openTrades.length,
              totalRisk: openTrades.reduce((sum, t) => sum + (t.riskAmount || 0), 0),
              avgEntry: openTrades.length > 0 ? openTrades.reduce((sum, t) => sum + t.entryPrice, 0) / openTrades.length : 0
            }
          };
        }

        const winningTrades = closedTrades.filter(t => t.pnl > 0);
        const losingTrades = closedTrades.filter(t => t.pnl < 0);

        const totalPnL = closedTrades.reduce((sum, t) => sum + t.pnl, 0);
        const grossProfit = winningTrades.reduce((sum, t) => sum + t.pnl, 0);
        const grossLoss = Math.abs(losingTrades.reduce((sum, t) => sum + t.pnl, 0));

        const avgWin = winningTrades.length > 0 ? grossProfit / winningTrades.length : 0;
        const avgLoss = losingTrades.length > 0 ? grossLoss / losingTrades.length : 0;

        const winRate = (winningTrades.length / closedTrades.length) * 100;
        const lossRate = 100 - winRate;

        const profitFactor = grossLoss > 0 ? grossProfit / grossLoss : 0;
        const expectancy = (winRate / 100 * avgWin) - (lossRate / 100 * avgLoss);

        const avgRR = closedTrades.reduce((sum, t) => sum + (t.rrNumeric || 0), 0) / closedTrades.length;

        const bestTrade = Math.max(...closedTrades.map(t => t.pnl));
        const worstTrade = Math.min(...closedTrades.map(t => t.pnl));

        return {
          closed: {
            totalTrades: closedTrades.length,
            winningTrades: winningTrades.length,
            losingTrades: losingTrades.length,
            winRate,
            totalPnL,
            avgWin,
            avgLoss,
            avgRR,
            profitFactor,
            expectancy,
            bestTrade,
            worstTrade
          },
          open: {
            count: openTrades.length,
            totalRisk: openTrades.reduce((sum, t) => sum + (t.riskAmount || 0), 0),
            avgEntry: openTrades.length > 0 ? openTrades.reduce((sum, t) => sum + t.entryPrice, 0) / openTrades.length : 0
          }
        };
      }
    };

    /* ===================================
       UI LAYER
       =================================== */
    const UI = {
      // Show notification
      showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification notification--${type}`;
        notification.textContent = message;
        document.body.appendChild(notification);

        setTimeout(() => {
          notification.remove();
        }, 3000);
      },

      // Render metrics dashboard
      renderMetrics(metrics) {
        const metricsGrid = document.getElementById('metricsGrid');
        const { closed } = metrics;

        metricsGrid.innerHTML = `
          <div class="metric-card metric-card--primary">
            <div class="metric-card__label">Win Rate</div>
            <div class="metric-card__value ${closed.winRate >= 50 ? 'metric-card__value--success' : 'metric-card__value--danger'}">
              ${formatPercentage(closed.winRate)}
            </div>
          </div>

          <div class="metric-card metric-card--primary">
            <div class="metric-card__label">Total P&L</div>
            <div class="metric-card__value ${closed.totalPnL >= 0 ? 'metric-card__value--success' : 'metric-card__value--danger'}">
              ${formatCurrency(closed.totalPnL)}
            </div>
          </div>

          <div class="metric-card metric-card--primary">
            <div class="metric-card__label">Avg R:R</div>
            <div class="metric-card__value">
              1:${closed.avgRR.toFixed(2)}
            </div>
          </div>

          <div class="metric-card metric-card--primary">
            <div class="metric-card__label">Total Trades</div>
            <div class="metric-card__value">
              ${closed.totalTrades}
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-card__label">Winning Trades</div>
            <div class="metric-card__value metric-card__value--success">
              ${closed.winningTrades} (${formatPercentage(closed.totalTrades > 0 ? (closed.winningTrades / closed.totalTrades * 100) : 0)})
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-card__label">Losing Trades</div>
            <div class="metric-card__value metric-card__value--danger">
              ${closed.losingTrades} (${formatPercentage(closed.totalTrades > 0 ? (closed.losingTrades / closed.totalTrades * 100) : 0)})
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-card__label">Average Win</div>
            <div class="metric-card__value metric-card__value--success">
              ${formatCurrency(closed.avgWin)}
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-card__label">Average Loss</div>
            <div class="metric-card__value metric-card__value--danger">
              ${formatCurrency(-closed.avgLoss)}
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-card__label">Profit Factor</div>
            <div class="metric-card__value ${closed.profitFactor >= 1 ? 'metric-card__value--success' : 'metric-card__value--danger'}">
              ${closed.profitFactor.toFixed(2)}
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-card__label">Expectancy</div>
            <div class="metric-card__value ${closed.expectancy >= 0 ? 'metric-card__value--success' : 'metric-card__value--danger'}">
              ${formatCurrency(closed.expectancy)}
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-card__label">Best Trade</div>
            <div class="metric-card__value metric-card__value--success">
              ${formatCurrency(closed.bestTrade)}
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-card__label">Worst Trade</div>
            <div class="metric-card__value metric-card__value--danger">
              ${formatCurrency(closed.worstTrade)}
            </div>
          </div>
        `;

        // Render open trades summary
        const openTradesGrid = document.getElementById('openTradesGrid');
        const { open } = metrics;

        openTradesGrid.innerHTML = `
          <div class="metric-card">
            <div class="metric-card__label">Open Positions</div>
            <div class="metric-card__value metric-card__value--info">
              ${open.count}
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-card__label">Total Risk Exposed</div>
            <div class="metric-card__value metric-card__value--info">
              ‚Ç¨${open.totalRisk.toFixed(2)}
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-card__label">Avg Entry Price</div>
            <div class="metric-card__value">
              ‚Ç¨${open.avgEntry.toFixed(2)}
            </div>
          </div>
        `;
      },

      // Render trades table
      renderTrades(trades, page = 1) {
        const tbody = document.getElementById('tradesTableBody');

        if (trades.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="11">
                <div class="empty-state">
                  <div class="empty-state__icon">üì≠</div>
                  <div class="empty-state__message">No trades yet</div>
                  <div class="empty-state__hint">Add your first trade using the form above</div>
                </div>
              </td>
            </tr>
          `;
          document.getElementById('pagination').innerHTML = '';
          return;
        }

        // Pagination
        const startIndex = (page - 1) * CONFIG.TRADES_PER_PAGE;
        const endIndex = startIndex + CONFIG.TRADES_PER_PAGE;
        const paginatedTrades = trades.slice(startIndex, endIndex);

        tbody.innerHTML = paginatedTrades.map(trade => {
          const rowClass = trade.status === 'open' ? 'trades-table__row--open' :
                          (trade.outcome === 'win' ? 'trades-table__row--win' : 'trades-table__row--loss');

          const pnlDisplay = trade.status === 'open' ?
            `<span class="trades-table__cell--info">Risk: ‚Ç¨${trade.riskAmount.toFixed(2)}</span>` :
            `<span class="${trade.pnl >= 0 ? 'trades-table__cell--success' : 'trades-table__cell--danger'}">${formatCurrency(trade.pnl)}</span>`;

          const rrDisplay = trade.status === 'open' ? '‚Äî' : trade.riskReward;

          return `
            <tr class="trades-table__row ${rowClass}">
              <td class="trades-table__cell">
                <span class="${trade.status === 'open' ? 'trades-table__cell--info' : ''}">${trade.status.toUpperCase()}</span>
              </td>
              <td class="trades-table__cell">${formatDate(trade.date)}</td>
              <td class="trades-table__cell">${trade.symbol}</td>
              <td class="trades-table__cell">${trade.direction.toUpperCase()}</td>
              <td class="trades-table__cell">‚Ç¨${trade.entryPrice.toFixed(2)}</td>
              <td class="trades-table__cell">${trade.exitPrice ? '‚Ç¨' + trade.exitPrice.toFixed(2) : '‚Äî'}</td>
              <td class="trades-table__cell">‚Ç¨${trade.stopLoss.toFixed(2)}</td>
              <td class="trades-table__cell">${pnlDisplay}</td>
              <td class="trades-table__cell">${rrDisplay}</td>
              <td class="trades-table__cell">${trade.strategy}</td>
              <td class="trades-table__cell">
                <div class="trades-table__actions">
                  <button class="btn btn--secondary btn--small" onclick="handleEdit('${trade.id}')">‚úèÔ∏è</button>
                  <button class="btn btn--danger btn--small" onclick="handleDelete('${trade.id}')">üóëÔ∏è</button>
                </div>
              </td>
            </tr>
          `;
        }).join('');

        // Render pagination
        this.renderPagination(trades.length, page);
      },

      // Render pagination
      renderPagination(totalTrades, currentPage) {
        const totalPages = Math.ceil(totalTrades / CONFIG.TRADES_PER_PAGE);
        const pagination = document.getElementById('pagination');

        if (totalPages <= 1) {
          pagination.innerHTML = '';
          return;
        }

        pagination.innerHTML = `
          <button class="btn btn--secondary btn--small" ${currentPage === 1 ? 'disabled' : ''} onclick="handlePageChange(${currentPage - 1})">
            ‚Üê Previous
          </button>
          <span class="pagination__info">Page ${currentPage} of ${totalPages}</span>
          <button class="btn btn--secondary btn--small" ${currentPage === totalPages ? 'disabled' : ''} onclick="handlePageChange(${currentPage + 1})">
            Next ‚Üí
          </button>
        `;
      },

      // Populate strategy dropdowns
      populateStrategyDropdowns() {
        const strategies = DataService.getStrategies();
        const tradeStrategySelect = document.getElementById('tradeStrategy');
        const strategyFilterSelect = document.getElementById('strategyFilter');

        // Populate form dropdown
        tradeStrategySelect.innerHTML = strategies.map(s =>
          `<option value="${s}">${s}</option>`
        ).join('');

        // Populate filter dropdown
        strategyFilterSelect.innerHTML = '<option value="all">All Strategies</option>' +
          strategies.map(s => `<option value="${s}">${s}</option>`).join('');
      },

      // Populate form for editing
      populateForm(trade) {
        document.getElementById('tradeDate').value = trade.date;
        document.getElementById('tradeSymbol').value = trade.symbol;
        document.getElementById('tradeDirection').value = trade.direction;
        document.getElementById('tradeEntry').value = trade.entryPrice;
        document.getElementById('tradeExit').value = trade.exitPrice || '';
        document.getElementById('tradeStopLoss').value = trade.stopLoss;
        document.getElementById('tradeSize').value = trade.positionSize;
        document.getElementById('tradeStatus').value = trade.status;
        document.getElementById('tradeStrategy').value = trade.strategy;
        document.getElementById('tradeNotes').value = trade.notes || '';

        document.getElementById('submitBtn').textContent = 'Update Trade';

        // Scroll to form
        document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
      },

      // Reset form
      resetForm() {
        document.getElementById('tradeForm').reset();
        document.getElementById('submitBtn').textContent = 'Add Trade';
        editingTradeId = null;
        this.updateExitFieldRequirement();
      }
      ,

      // Update exit field requirement based on status
      updateExitFieldRequirement() {
        const status = document.getElementById('tradeStatus').value;
        const exitInput = document.getElementById('tradeExit');
        const exitLabel = document.getElementById('exitLabel');

        if (status === 'closed') {
          exitInput.required = true;
          exitLabel.classList.add('form-group__label--required');
        } else {
          exitInput.required = false;
          exitLabel.classList.remove('form-group__label--required');
        }
      }
    };

    /* ===================================
       EVENT HANDLERS
       =================================== */

    // Handle form submission
    function handleFormSubmit(event) {
      event.preventDefault();

      const formData = {
        date: document.getElementById('tradeDate').value,
        symbol: document.getElementById('tradeSymbol').value.toUpperCase(),
        direction: document.getElementById('tradeDirection').value,
        entryPrice: parseFloat(document.getElementById('tradeEntry').value),
        exitPrice: document.getElementById('tradeExit').value ? parseFloat(document.getElementById('tradeExit').value) : null,
        stopLoss: parseFloat(document.getElementById('tradeStopLoss').value),
        positionSize: parseFloat(document.getElementById('tradeSize').value),
        status: document.getElementById('tradeStatus').value,
        strategy: document.getElementById('tradeStrategy').value,
        notes: document.getElementById('tradeNotes').value
      };

      // Validation
      if (formData.status === 'closed' && !formData.exitPrice) {
        UI.showNotification('Exit price is required for closed trades', 'error');
        return;
      }

      // Validate stop loss position
      if (formData.direction === 'long' && formData.stopLoss >= formData.entryPrice) {
        UI.showNotification('Stop loss must be below entry price for long trades', 'error');
        return;
      }

      if (formData.direction === 'short' && formData.stopLoss <= formData.entryPrice) {
        UI.showNotification('Stop loss must be above entry price for short trades', 'error');
        return;
      }

      // Calculate risk
      const riskAmount = Calculator.calculateRisk(formData.entryPrice, formData.stopLoss, formData.positionSize);

      // Calculate P&L and R:R for closed trades
      let pnl = null;
      let rewardAmount = null;
      let rrData = null;
      let outcome = null;

      if (formData.status === 'closed') {
        pnl = Calculator.calculatePnL(formData.direction, formData.entryPrice, formData.exitPrice, formData.positionSize);
        rewardAmount = Calculator.calculateReward(formData.entryPrice, formData.exitPrice, formData.positionSize);
        rrData = Calculator.calculateRiskReward(riskAmount, rewardAmount);
        outcome = pnl > 0 ? 'win' : (pnl < 0 ? 'loss' : 'breakeven');
      }

      const trade = {
        ...formData,
        displayDate: formatDate(formData.date),
        timestamp: new Date(formData.date).getTime(),
        riskAmount,
        pnl,
        rewardAmount,
        riskReward: rrData ? rrData.formatted : null,
        rrNumeric: rrData ? rrData.numeric : null,
        outcome
      };

      if (editingTradeId) {
        // Update existing trade
        if (DataService.updateTrade(editingTradeId, trade)) {
          UI.showNotification('Trade updated successfully', 'success');
          UI.resetForm();
          renderDashboard();
        }
      } else {
        // Add new trade
        trade.id = generateUUID();
        trade.createdAt = Date.now();
        trade.updatedAt = Date.now();

        if (DataService.addTrade(trade)) {
          UI.showNotification('Trade added successfully', 'success');
          UI.resetForm();
          renderDashboard();
        }
      }
    }

    // Handle edit trade
    function handleEdit(id) {
      const trades = DataService.getTrades();
      const trade = trades.find(t => t.id === id);

      if (trade) {
        editingTradeId = id;
        UI.populateForm(trade);
      }
    }

    // Handle delete trade
    function handleDelete(id) {
      if (confirm('Are you sure you want to delete this trade?')) {
        if (DataService.deleteTrade(id)) {
          UI.showNotification('Trade deleted successfully', 'success');
          renderDashboard();
        }
      }
    }

    // Handle page change
    function handlePageChange(page) {
      currentPage = page;
      applyFiltersAndRender();
    }

    // Handle export to CSV
    function handleExportCsv() {
      const trades = DataService.getTrades();

      if (trades.length === 0) {
        UI.showNotification('No trades to export', 'error');
        return;
      }

      // CSV headers
      const headers = ['Date', 'Symbol', 'Direction', 'Entry', 'Exit', 'Stop Loss', 'Position Size', 'Status', 'P&L', 'Risk', 'R:R', 'Strategy', 'Notes'];

      // CSV rows
      const rows = trades.map(t => [
        formatDate(t.date),
        t.symbol,
        t.direction,
        t.entryPrice,
        t.exitPrice || '',
        t.stopLoss,
        t.positionSize,
        t.status,
        t.pnl || '',
        t.riskAmount,
        t.riskReward || '',
        t.strategy,
        `"${(t.notes || '').replace(/"/g, '""')}"`
      ]);

      const csv = [headers, ...rows].map(row => row.join(',')).join('\n');

      // Download
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `trading-journal-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      URL.revokeObjectURL(url);

      UI.showNotification('Trades exported to CSV', 'success');
    }

    // Handle export to JSON
    function handleExportJson() {
      const trades = DataService.getTrades();

      if (trades.length === 0) {
        UI.showNotification('No trades to export', 'error');
        return;
      }

      const data = {
        version: CONFIG.VERSION,
        exportDate: new Date().toISOString(),
        trades
      };

      const json = JSON.stringify(data, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `trading-journal-backup-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);

      UI.showNotification('Trades exported to JSON', 'success');
    }

    // Handle import from JSON
    function handleImportJson() {
      document.getElementById('jsonFileInput').click();
    }

    function handleJsonFileSelect(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);

          if (!data.trades || !Array.isArray(data.trades)) {
            UI.showNotification('Invalid JSON file format', 'error');
            return;
          }

          if (confirm(`Import ${data.trades.length} trades? This will replace your current data.`)) {
            DataService.saveTrades(data.trades);
            UI.showNotification('Trades imported successfully', 'success');
            renderDashboard();
          }
        } catch (error) {
          UI.showNotification('Error reading JSON file', 'error');
          console.error(error);
        }
      };

      reader.readAsText(file);
      event.target.value = ''; // Reset file input
    }

    // Handle import strategies
    function handleImportStrategies() {
      document.getElementById('strategyFileInput').click();
    }

    function handleStrategyFilesSelect(event) {
      const files = Array.from(event.target.files);
      if (files.length === 0) return;

      const existingStrategies = DataService.getStrategies();
      const newStrategies = [];

      let filesProcessed = 0;

      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = JSON.parse(e.target.result);

            if (data.name && !existingStrategies.includes(data.name) && !newStrategies.includes(data.name)) {
              newStrategies.push(data.name);
            }
          } catch (error) {
            console.error(`Error reading ${file.name}:`, error);
          }

          filesProcessed++;

          if (filesProcessed === files.length) {
            if (newStrategies.length > 0) {
              const updatedStrategies = [...existingStrategies, ...newStrategies];
              DataService.saveStrategies(updatedStrategies);
              UI.populateStrategyDropdowns();
              UI.showNotification(`${newStrategies.length} strategies imported`, 'success');
            } else {
              UI.showNotification('No new strategies found', 'info');
            }
          }
        };

        reader.readAsText(file);
      });

      event.target.value = ''; // Reset file input
    }

    // Handle clear all data
    function handleClearData() {
      if (confirm('Are you sure you want to clear all data? This cannot be undone!')) {
        if (confirm('This will delete all trades and strategies. Are you absolutely sure?')) {
          DataService.clearAll();
          UI.showNotification('All data cleared', 'info');
          renderDashboard();
        }
      }
    }

    /* ===================================
       GITHUB SYNC HANDLERS
       =================================== */

    // Handle GitHub setup button click
    function handleGithubSetup() {
      const modal = document.getElementById('githubSetupModal');
      const tokenInput = document.getElementById('githubTokenInput');
      const errorDiv = document.getElementById('githubSetupError');
      const successDiv = document.getElementById('githubSetupSuccess');

      // Reset modal state
      tokenInput.value = GitHubSync.getToken() || '';
      errorDiv.style.display = 'none';
      successDiv.style.display = 'none';

      modal.style.display = 'flex';
    }

    // Handle GitHub setup close
    function handleCloseGithubModal() {
      const modal = document.getElementById('githubSetupModal');
      modal.style.display = 'none';
    }

    // Handle GitHub token save
    async function handleSaveGithubToken() {
      const tokenInput = document.getElementById('githubTokenInput');
      const errorDiv = document.getElementById('githubSetupError');
      const successDiv = document.getElementById('githubSetupSuccess');
      const saveBtn = document.getElementById('saveGithubToken');

      const token = tokenInput.value.trim();

      if (!token) {
        errorDiv.querySelector('p').textContent = 'Please enter a GitHub token';
        errorDiv.style.display = 'block';
        successDiv.style.display = 'none';
        return;
      }

      // Disable button while verifying
      saveBtn.disabled = true;
      saveBtn.textContent = 'Verifying...';
      errorDiv.style.display = 'none';
      successDiv.style.display = 'none';

      try {
        // Verify token is valid
        await GitHubSync.verifyToken(token);

        // Save token
        GitHubSync.saveToken(token);

        // Show success message
        successDiv.style.display = 'block';
        errorDiv.style.display = 'none';

        // Initialize sync UI
        initializeGithubSyncUI();

        // Auto-sync disabled to avoid API rate limits - use manual "Sync Now" button instead
        // GitHubSync.startAutoSync();

        // Load data from GitHub
        const data = await GitHubSync.loadFromGist();
        if (data && data.trades && data.trades.length > 0) {
          // Ask user if they want to merge or replace
          if (confirm(`Found ${data.trades.length} trades in GitHub. Do you want to load them?\n\nOK = Load from GitHub\nCancel = Keep local data`)) {
            DataService.saveTrades(data.trades);
            if (data.strategies) {
              DataService.saveStrategies(data.strategies);
            }
            renderDashboard();
            UI.showNotification('Data loaded from GitHub', 'success');
          }
        } else {
          // No data in GitHub, sync current local data
          const trades = DataService.getTrades();
          const strategies = DataService.getStrategies();
          if (trades.length > 0) {
            await GitHubSync.syncToGist(trades, strategies);
            UI.showNotification('Local data synced to GitHub', 'success');
          }
        }

        // Close modal after a delay
        setTimeout(() => {
          handleCloseGithubModal();
        }, 2000);

      } catch (error) {
        console.error('GitHub setup error:', error);
        errorDiv.querySelector('p').textContent = error.message || 'Failed to verify token. Please check your token and try again.';
        errorDiv.style.display = 'block';
        successDiv.style.display = 'none';
      } finally {
        saveBtn.disabled = false;
        saveBtn.textContent = 'Save & Enable Sync';
      }
    }

    // Handle manual sync button
    async function handleManualSync() {
      try {
        // Step 1: Load data from GitHub first
        const githubData = await GitHubSync.loadFromGist();

        if (githubData && githubData.trades) {
          // GitHub has data, merge with local
          const localTrades = DataService.getTrades();

          // If local has no data and GitHub has data, use GitHub data
          if (localTrades.length === 0 && githubData.trades.length > 0) {
            DataService.saveTrades(githubData.trades);
            if (githubData.strategies) {
              DataService.saveStrategies(githubData.strategies);
            }
            renderDashboard();
            UI.showNotification('Synced from GitHub', 'success');
            return;
          }

          // If both have data, prefer GitHub (it's likely the source of truth)
          if (githubData.trades.length > 0) {
            const shouldUseGithub = confirm(
              `GitHub has ${githubData.trades.length} trades, you have ${localTrades.length} locally.\n\n` +
              `OK = Use GitHub data (recommended)\n` +
              `Cancel = Upload your local data to GitHub`
            );

            if (shouldUseGithub) {
              DataService.saveTrades(githubData.trades);
              if (githubData.strategies) {
                DataService.saveStrategies(githubData.strategies);
              }
              renderDashboard();
              UI.showNotification('Synced from GitHub', 'success');
              return;
            }
          }
        }

        // Step 2: Upload local data to GitHub
        const trades = DataService.getTrades();
        const strategies = DataService.getStrategies();
        await GitHubSync.syncToGist(trades, strategies);
        UI.showNotification('Synced to GitHub', 'success');

      } catch (error) {
        console.error('Manual sync error:', error);
        UI.showNotification(`Sync failed: ${error.message}`, 'error');
      }
    }

    // Initialize GitHub sync UI elements
    function initializeGithubSyncUI() {
      const syncStatus = document.getElementById('syncStatus');
      const setupBtn = document.getElementById('githubSetupBtn');
      const manualSyncBtn = document.getElementById('manualSyncBtn');

      if (GitHubSync.isEnabled()) {
        syncStatus.style.display = 'flex';
        setupBtn.style.display = 'none';
        manualSyncBtn.style.display = 'inline-block';
        GitHubSync.updateSyncStatus('synced', 'Ready');
      } else {
        syncStatus.style.display = 'none';
        setupBtn.style.display = 'inline-block';
        manualSyncBtn.style.display = 'none';
      }
    }

    // Handle sort
    function handleSort(column) {
      if (sortColumn === column) {
        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        sortColumn = column;
        sortDirection = 'desc';
      }

      applyFiltersAndRender();
    }

    // Apply filters and render
    function applyFiltersAndRender() {
      let trades = DataService.getTrades();

      // Apply search filter
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      if (searchTerm) {
        trades = trades.filter(t => t.symbol.toLowerCase().includes(searchTerm));
      }

      // Apply status filter
      const statusFilter = document.getElementById('statusFilter').value;
      if (statusFilter !== 'all') {
        trades = trades.filter(t => t.status === statusFilter);
      }

      // Apply strategy filter
      const strategyFilter = document.getElementById('strategyFilter').value;
      if (strategyFilter !== 'all') {
        trades = trades.filter(t => t.strategy === strategyFilter);
      }

      // Apply sorting
      trades.sort((a, b) => {
        let aVal = a[sortColumn];
        let bVal = b[sortColumn];

        // Handle null/undefined values
        if (aVal === null || aVal === undefined) aVal = '';
        if (bVal === null || bVal === undefined) bVal = '';

        if (typeof aVal === 'string') {
          aVal = aVal.toLowerCase();
          bVal = bVal.toLowerCase();
        }

        if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
        if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
        return 0;
      });

      UI.renderTrades(trades, currentPage);
    }

    // Render entire dashboard
    function renderDashboard() {
      const trades = DataService.getTrades();
      const metrics = Calculator.calculateMetrics(trades);

      UI.renderMetrics(metrics);
      applyFiltersAndRender();
      UI.populateStrategyDropdowns();
    }

    /* ===================================
       INITIALIZATION
       =================================== */
    function init() {
      // Populate strategy dropdowns
      UI.populateStrategyDropdowns();

      // Render dashboard
      renderDashboard();

      // Event listeners
      document.getElementById('tradeForm').addEventListener('submit', handleFormSubmit);
      document.getElementById('cancelBtn').addEventListener('click', () => UI.resetForm());
      document.getElementById('tradeStatus').addEventListener('change', () => UI.updateExitFieldRequirement());

      document.getElementById('exportCsvBtn').addEventListener('click', handleExportCsv);
      document.getElementById('exportJsonBtn').addEventListener('click', handleExportJson);
      document.getElementById('importJsonBtn').addEventListener('click', handleImportJson);
      document.getElementById('importStrategiesBtn').addEventListener('click', handleImportStrategies);
      document.getElementById('clearDataBtn').addEventListener('click', handleClearData);

      document.getElementById('jsonFileInput').addEventListener('change', handleJsonFileSelect);
      document.getElementById('strategyFileInput').addEventListener('change', handleStrategyFilesSelect);

      document.getElementById('searchInput').addEventListener('input', () => {
        currentPage = 1;
        applyFiltersAndRender();
      });

      document.getElementById('statusFilter').addEventListener('change', () => {
        currentPage = 1;
        applyFiltersAndRender();
      });

      document.getElementById('strategyFilter').addEventListener('change', () => {
        currentPage = 1;
        applyFiltersAndRender();
      });

      // Sort headers
      document.querySelectorAll('.trades-table__header-cell[data-sort]').forEach(header => {
        header.addEventListener('click', () => handleSort(header.dataset.sort));
      });

      // Form toggle
      const formToggle = document.getElementById('formToggle');
      const formContent = document.getElementById('formContent');
      const toggleIcon = document.querySelector('.form-section__toggle');

      formToggle.addEventListener('click', () => {
        const isCollapsed = formContent.classList.toggle('form-section__content--collapsed');
        toggleIcon.textContent = isCollapsed ? '+' : '‚àí';
      });

      // GitHub Sync event listeners
      document.getElementById('githubSetupBtn').addEventListener('click', handleGithubSetup);
      document.getElementById('manualSyncBtn').addEventListener('click', handleManualSync);
      document.getElementById('closeGithubModal').addEventListener('click', handleCloseGithubModal);
      document.getElementById('cancelGithubSetup').addEventListener('click', handleCloseGithubModal);
      document.getElementById('saveGithubToken').addEventListener('click', handleSaveGithubToken);

      // Close modal when clicking outside
      document.getElementById('githubSetupModal').addEventListener('click', (e) => {
        if (e.target.id === 'githubSetupModal') {
          handleCloseGithubModal();
        }
      });

      // Initialize GitHub sync UI
      initializeGithubSyncUI();

      // If GitHub sync is enabled, load data from GitHub and start auto-sync
      if (GitHubSync.isEnabled()) {
        GitHubSync.loadFromGist().then(data => {
          if (data && data.trades) {
            // Merge GitHub data with local data
            const localTrades = DataService.getTrades();
            if (localTrades.length === 0 && data.trades.length > 0) {
              // No local data, use GitHub data
              DataService.saveTrades(data.trades);
              if (data.strategies) {
                DataService.saveStrategies(data.strategies);
              }
              renderDashboard();
              console.log('Loaded data from GitHub');
            }
          }
        }).catch(err => {
          console.error('Failed to load from GitHub:', err);
        });

        // Auto-sync disabled to avoid API rate limits - use manual "Sync Now" button instead
        // GitHubSync.startAutoSync();
      }

      // Set today's date as default
      document.getElementById('tradeDate').valueAsDate = new Date();
    }

    // Start the application
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
